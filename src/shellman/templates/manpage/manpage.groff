.if n.ad l
.nh

.TH {{ doc.filename }} 1 "{% if doc.sections.version -%}
Version {{ doc.sections.version[0].text }} - {% endif -%}
{% if doc.sections.date %}{{ doc.sections.date[0].text }}{% else %}{{ now }}{% endif %}" "Shellman {{ shellman_version }}" "User Commands"

{% if doc.sections.brief %}
.SH "NAME"
{{ doc.filename }} \- {{ doc.sections.brief[0].text }}

{% endif %}
{% if doc.sections.usage %}
.SH "SYNOPSIS"
{% for usage in doc.sections.usage %}
{{ usage.program|groffstrong }} {{ usage.command|groffauto }}
{% if not loop.last %}
.br
{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.desc %}
.SH "DESCRIPTION"
{% for desc in doc.sections.desc %}
{{ desc.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.option %}
.SH "OPTIONS"
{% for opt_group, opt_list in doc.sections.option|groupby('group', sort=False) %}
{% if opt_group %}
.SS "{{ opt_group }}"
{% endif %}
{% for option in opt_list %}
{% with sign = option.signature.lstrip() %}
{% if sign|length > context.indent-2 %}
.IP "{{ sign|groffauto }}" {{ context.indent }}
{{ option.description + '\n' }}
{% else %}
.TP
{{ "{sign:{padding}}"|format(sign=sign, padding=context.indent-1)|groffauto }} {{ option.description }}
{% endif %}
{% endwith %}
{% endfor %}
{% endfor %}

{% endif %}
{% if doc.sections.env %}
.SH "ENVIRONMENT VARIABLES"
{% for env in doc.sections.env %}
.TP
.B {{ env.name }}
{{ env.description }}
{% endfor %}

{% endif %}
{% if doc.sections.file %}
.SH "FILES"
{% for file in doc.sections.file %}
.TP
.I {{ file.name }}
{{ file.description }}
{% endfor %}

{% endif %}
{% if doc.sections.exit %}
.SH "EXIT STATUS"
{% for exit in doc.sections.exit %}
.TP
.B {{ exit.code }}
{{ exit.description }}
{% endfor %}

{% endif %}
{% if doc.sections.stdin %}
.SH "STANDARD INPUT"
{% for stdin in doc.sections.stdin %}
{{ stdin.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.stdout %}
.SH "STANDARD OUTPUT"
{% for stdout in doc.sections.stdout %}
{{ stdout.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.stderr %}
.SH "STANDARD ERROR"
{% for stderr in doc.sections.stderr %}
{{ stderr.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.function %}
.SH "FUNCTIONS"
{% for function in doc.sections.function %}
{% include "function.groff" with context %}
{% endfor %}

{% endif %}
{% if doc.sections.example %}
.SH "EXAMPLES"
{% for example in doc.sections.example %}
.IP "{{ example.title|groffstrong }}" {{ context.indent }}
{% if example.code %}{{ "\n" + example.code + "\n\n" }}{% endif %}
{% if example.explanation %}{{ example.explanation + "\n" }}{% endif %}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.error %}
.SH "ERRORS"
{% for error in doc.sections.error %}
{{ error.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.bug %}
.SH "BUGS"
{% for bug in doc.sections.bug %}
{{ bug.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.caveat %}
.SH "CAVEATS"
{% for caveat in doc.sections.caveat %}
{{ caveat.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.author %}
.SH "AUTHORS"
{% for author in doc.sections.author %}
{{ author.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.copyright %}
.SH "COPYRIGHT"
{% for copyright in doc.sections.copyright %}
{{ copyright.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.license %}
.SH "LICENSE"
{% for license in doc.sections.license %}
{{ license.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.history %}
.SH "HISTORY"
{% for history in doc.sections.history %}
{{ history.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.note %}
.SH "NOTES"
{% for note in doc.sections.note %}
{{ note.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}

{% endif %}
{% if doc.sections.seealso %}
.SH "SEE ALSO"
{% for seealso in doc.sections.seealso %}
{{ seealso.text }}
{% if not loop.last %}{{ "\n" }}{% endif %}
{% endfor %}
{% endif %}
